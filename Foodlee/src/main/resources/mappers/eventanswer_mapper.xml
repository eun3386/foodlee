<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="IEventAnswerDAO">

	<insert id="answerAdd" parameterType="eventanswerVO" >
		insert into answers values
		(null,#{reply},0,#{articleId},
		#{memberId},now(),now())
	</insert>
	
	<resultMap type="eventanswerVO" id="asResultMap">
		<id property="id" column="id"/>		
		<result property="reply" 
				column="reply"/>
		<result property="compassion" 
				column="compassion"/>
		<result property="articleId" 
				column="article_id"/>
		<result property="memberId" 
				column="member_id"/>
		<result property="createdAt" 
				column="created_at"/>
		<result property="updatedAt" 
				column="updated_at"/>										
	</resultMap>
	
	<select id="answerList" resultType="eventanswerVO">
		select * from answers order by created_at desc
	</select>
	
	<!-- mapUnderscoreToCamelCase 설정이나 
	 ResultMap을 결과맵으로 연동하여 사용 -->
	<select id="answerListForArticle" parameterType="int" 
		 resultType="eventanswerVO">	
<!-- 		 resultMap="asResultMap">   -->
<!-- 		 resultType="answerVO"> -->
		select * from answers where article_id = #{atId}   
		order by created_at desc
	</select>
	
	<select id="checkNumberOfAnswersForArticle"
		parameterType="int" resultType="int">
		select count(*) from answers  
			 where article_id = #{atId} 
	</select>
	
	<select id="answerSelectOne" parameterType="int" 
		resultType="eventanswerVO">
		SELECT * FROM ANSWERS WHERE id = #{id}  
	</select>
	
	<update id="answerUpdate" parameterType="eventanswerVO">
		UPDATE ANSWERS SET reply = #{reply},
		 	updated_at = now()   
			WHERE id = #{id}
	</update>
	
	<update id="increaseCompassion" parameterType="int">
		<![CDATA[
		UPDATE ANSWERS SET compassion = compassion+1, 
		 	updated_at = now()    
			WHERE id = #{id}
		]]>
	</update>
	
	<delete id="answerRemove" parameterType="int">
		DELETE FROM ANSWERS WHERE id = #{id} 
	</delete>

</mapper>
